<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    


 
        <div style="display: flex; flex-direction: column;">
            <input id="clientId" type="text" placeholder="clientId">
            <input id="token" type="password" placeholder="token">
            <button id="saveCredentials">Запази парола</button>
            <button id="loadCredentials">Зареди парола</button>
        </div>

        <input id="" type="text" />

        <button id="send">Запаси</button>
   
        <script>

        document.getElementById("loadCredentials").addEventListener("click", loadCredentialsFromLocalStorageToInputs);
        document.getElementById("saveCredentials").addEventListener("click", saveCredentials);
        document.getElementById("send").addEventListener("click", updateJsonFile);
        window.addEventListener("load", loadCredentialsFromLocalStorageToInputs); // Load credentials from local storage on page load

        // let clientId ="";
        // let token ="";

        // Set Credentials
        function saveCredentials() {
            let clientId = document.getElementById("clientId").value;
            let token = document.getElementById("token").value;

            localStorage.setItem("clientId", clientId);
            localStorage.setItem("token", token);
        }


        // Load Credentials
        function loadCredentialsFromLocalStorageToInputs() {
            
            clientId = localStorage.getItem("clientId");
            token = localStorage.getItem("token");

            document.getElementById("clientId").value = clientId;
            document.getElementById("token").value = token;
        }

 
        //Post
        // function update() {

        //     fetch(`https://api.github.com/repos/stevicamp/Stevicamp/contents/test.txt?client_id=${clientId}&access_token=${token}`, {
        //         method: "PUT",
        //         headers: { 'Content-Type': 'application/json', 'Authorization':`${token}` },
        //         body: JSON.stringify('asdfghj')
        //     }).then(response => {
        //         console.log("Request complete! response:", response);
        //     });
        // }











        // Replace with your details
const owner = "stevicamp";
const repo = "Stevicamp";
const path = "test.json";
const token = "3838828a07fe1baadd5934f0902c70deeac9b60f"; // Use a personal access token with 'repo' scope

// New JSON content
const newContent = {
  title: "Updated Book",
  author: "The name of author",
  price: 29.99
};

// Function to get the file's SHA
async function getFileSha() {
  try {
    const response = await fetch(
      `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
      {
        method: "GET",
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json",
          "Content-Type": "application/json"
        }
      }
    );
    if (!response.ok) 
    {
      if (response.status === 404) return null; // File doesn't exist
      throw new Error(`Failed to fetch SHA: ${response.statusText}`);
    }

      const data = await response.json();
      return data.sha;
    } 

     catch (error) 
    {
       console.error("Error fetching SHA:", error);
       return null;
    }
}

// Function to update the JSON file
async function updateJsonFile() {
  try {
    const sha = await getFileSha();
    const contentBase64 = btoa(JSON.stringify(newContent, null, 2));

    const body = {
      message: "Update myfile.json via API",
      content: contentBase64,
      sha: sha // Omit if creating a new file
    };

    const response = await fetch(
      `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
      {
        method: "PUT",
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(`Failed to update file: ${errorData.message}`);
    }

    const result = await response.json();
    console.log("File updated! Commit URL:", result.commit.html_url);
  } catch (error) {
    console.error("Error updating file:", error);
  }
}

updateJsonFile();
    </script>
</body>

</html>